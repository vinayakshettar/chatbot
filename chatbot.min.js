!function (t) { "use strict"; const e = { apiBaseUrl: "http://localhost:5000", endpoints: { createTicket: "/api/ticket", intentDetection: "/api/chatbot/intent" }, position: "bottom-right", primaryColor: "#259feb", chatbotName: "Support Assistant", autoOpen: !1, enableErrorDetection: !0, enableScreenshot: !0, maxFileSize: 5242880, maxFiles: 5, allowedFileTypes: ["image/jpeg", "image/png", "image/gif", "image/webp"], autoReportErrors: !0, autoReportDelay: 2e3, autoReportDefaults: { impact: "SingleUser", urgency: "CanWorkWithManyDifficulties", priority: "High", category: "Functional issue Report", contactDetails: "Auto-reported" }, headers: { "Content-Type": "application/json" }, onTicketCreated: null, onError: null, onOpen: null, onClose: null, onAutoReport: null }; class i { constructor(t = {}) { this.config = { ...e, ...t }, this.state = { isOpen: this.config.autoOpen, messages: [], currentStep: "greeting", ticketData: this.initTicketData(), detectedErrors: [], isLoading: !1, uploadedImages: [], sessionId: this.generateSessionId(), autoReportTimer: null, autoReportedErrors: [], pendingError: null }, this.options = this.initOptions(), this.container = null, this.init() } generateSessionId() { return "session_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9) } initTicketData() { return { impact: "", urgency: "", priority: "", category: "", description: "", contactDetails: "", images: [], errors: [], metadata: { userAgent: navigator.userAgent, url: t.location.href, timestamp: (new Date).toISOString() } } } initOptions() { return { impact: [{ id: "SingleUser", label: "Single user" }, { id: "GroupOfUsers", label: "Group of users" }, { id: "AllUsers", label: "All users" }], urgency: [{ id: "CanWorkNormally", label: "I can work normally anyway" }, { id: "CanWorkWithSomeDifficulties", label: "I can work with some difficulties" }, { id: "CanWorkWithManyDifficulties", label: "I can work but with many difficulties" }, { id: "CannotWork", label: "I cannot work" }], priority: [{ id: "Low", label: "Low" }, { id: "Normal", label: "Normal" }, { id: "High", label: "High" }, { id: "Critical", label: "Critical" }], category: ["UI/UX", "Functional issue Report", "Other"] } } init() { this.injectStyles(), this.createChatbotUI(), this.config.enableErrorDetection && this.setupErrorDetection(), this.state.isOpen && this.addMessage("bot", `üëã Hello! I'm ${this.config.chatbotName}. How can I help you today?`) } setupErrorDetection() { const e = this; t.addEventListener("error", (t => { this.captureError({ type: "JavaScript Error", message: t.message, file: t.filename, line: t.lineno, column: t.colno, timestamp: (new Date).toISOString(), severity: "high" }) })), t.addEventListener("unhandledrejection", (t => { this.captureError({ type: "Unhandled Promise", message: t.reason?.message || String(t.reason), timestamp: (new Date).toISOString(), severity: "high" }) })); const i = t.fetch; t.fetch = async (...t) => { try { const o = await i(...t); if (!o.ok && o.status >= 400) { const i = o.status >= 500 ? "critical" : "medium"; e.captureError({ type: `HTTP ${o.status}`, message: `${o.statusText} - ${t[0]}`, url: t[0], status: o.status, timestamp: (new Date).toISOString(), severity: i }) } return o } catch (i) { throw e.captureError({ type: "Network Error", message: `Failed: ${t[0]}`, error: i.message, timestamp: (new Date).toISOString(), severity: "critical" }), i } }; const o = t.XMLHttpRequest; t.XMLHttpRequest = function () { const t = new o, i = t.open; let s = ""; return t.open = function (t, e) { return s = e, i.apply(this, arguments) }, t.addEventListener("error", (() => { e.captureError({ type: "XHR Error", message: `Request failed: ${s}`, timestamp: (new Date).toISOString(), severity: "critical" }) })), t.addEventListener("load", (function () { if (this.status >= 400) { const t = this.status >= 500 ? "critical" : "medium"; e.captureError({ type: `HTTP ${this.status}`, message: `${this.statusText} - ${s}`, status: this.status, timestamp: (new Date).toISOString(), severity: t }) } })), t } } captureError(t) { const e = `${t.type}-${t.message}`; if (this.state.autoReportedErrors.includes(e)) return; this.state.detectedErrors.push(t), this.updateErrorBadge(); this.shouldAutoReportError(t) ? this.scheduleAutoReport(t, e) : "critical" === t.severity && (this.open(), this.state.currentStep = "error_detected", this.state.pendingError = t, this.addMessage("bot", `‚ö†Ô∏è We detected an error: ${t.message}. Would you like to report this?`)) } shouldAutoReportError(t) { if (!this.config.autoReportErrors) return !1; return ["HTTP 500", "HTTP 502", "HTTP 503", "HTTP 504", "Network Error", "JavaScript Error"].some((e => t.type.includes(e))) } scheduleAutoReport(t, e) { this.state.autoReportTimer && clearTimeout(this.state.autoReportTimer), this.state.autoReportTimer = setTimeout((() => { this.autoReportError(t, e) }), this.config.autoReportDelay) } async autoReportError(e, i) { this.state.autoReportedErrors.push(i); const o = this.buildErrorDescription(e), s = { ...this.config.autoReportDefaults, description: o, images: [], errors: [e, ...this.state.detectedErrors.slice(-5)], metadata: { userAgent: navigator.userAgent, url: t.location.href, timestamp: (new Date).toISOString(), sessionId: this.state.sessionId, autoReported: !0 } }; this.open(), this.addMessage("bot", `ü§ñ Auto-reporting error: ${e.type} - ${e.message}`); try { const t = new FormData; for (const e in s) "images" !== e && "errors" !== e && t.append(e, "object" == typeof s[e] ? JSON.stringify(s[e]) : s[e]); t.append("errors", JSON.stringify(s.errors)); const e = `${this.config.apiBaseUrl}${this.config.endpoints.createTicket}`, i = await fetch(e, { method: "POST", body: t }), o = await i.json(); this.addMessage("bot", `‚úÖ Error automatically reported as ticket #${o}. Our team will investigate.`), this.config.onAutoReport && this.config.onAutoReport(ticketId, s), this.state.detectedErrors = [], this.updateErrorBadge() } catch (t) { this.addMessage("bot", "‚ö†Ô∏è Auto-report failed. You can manually create a ticket if needed.") } } buildErrorDescription(e) { const i = ["ü§ñ AUTOMATICALLY REPORTED ERROR", "", `Primary Error: ${e.type}`, `Message: ${e.message}`, `Timestamp: ${e.timestamp}`, ""]; return e.url && i.push(`URL: ${e.url}`), e.file && i.push(`File: ${e.file}:${e.line}:${e.column}`), e.status && i.push(`Status Code: ${e.status}`), this.state.detectedErrors.length > 1 && (i.push("", "Recent errors:"), this.state.detectedErrors.slice(-3).forEach(((t, e) => { i.push(`${e + 1}. ${t.type}: ${t.message}`) }))), i.push("", `Session ID: ${this.state.sessionId}`), i.push(`User Agent: ${navigator.userAgent}`), i.push(`Page URL: ${t.location.href}`), i.join("\n") } updateErrorBadge() { const t = this.container?.querySelector(".chatbot-error-badge"); t && (t.textContent = this.state.detectedErrors.length, t.style.display = this.state.detectedErrors.length > 0 ? "flex" : "none") } injectStyles() { const t = `\n.support-chatbot * { box-sizing: border-box; margin: 0; padding: 0; }\n.support-chatbot { position: fixed; ${this.getPositionStyles()} z-index: 999999; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }\n.chatbot-button { width: 60px; height: 60px; border-radius: 50%; background: ${this.config.primaryColor}; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center; transition: transform 0.2s; position: relative; }\n.chatbot-button:hover { transform: scale(1.1); }\n.chatbot-button svg { width: 28px; height: 28px; fill: white; }\n.chatbot-error-badge { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 24px; height: 24px; font-size: 12px; font-weight: bold; display: none; align-items: center; justify-content: center; animation: pulse 2s infinite; }\n@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n.chatbot-window { width: 380px; height: 500px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); display: none; flex-direction: column; overflow: hidden; }\n.chatbot-window.open { display: flex; }\n.chatbot-header { background: linear-gradient(135deg, ${this.config.primaryColor} 0%, ${this.adjustColor(this.config.primaryColor, -20)} 100%); color: white; padding: 16px; display: flex; justify-content: space-between; align-items: center; }\n.chatbot-header-title { display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 16px; }\n.chatbot-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; font-size: 20px; line-height: 1; }\n.chatbot-close:hover { background: rgba(255,255,255,0.3); }\n.chatbot-messages { flex: 1; overflow-y: auto; padding: 16px; background: #f9fafb; }\n.chatbot-messages::-webkit-scrollbar { width: 6px; }\n.chatbot-messages::-webkit-scrollbar-track { background: #f1f1f1; }\n.chatbot-messages::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }\n.message { margin-bottom: 12px; display: flex; animation: slideIn 0.3s ease-out; }\n@keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n.message.user { justify-content: flex-end; }\n.message-content { max-width: 80%; padding: 12px; border-radius: 8px; font-size: 14px; line-height: 1.5; word-wrap: break-word; white-space: pre-wrap; }\n.message.bot .message-content { background: white; color: #1f2937; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }\n.message.user .message-content { background: ${this.config.primaryColor}; color: white; }\n.message-time { font-size: 11px; opacity: 0.7; margin-top: 4px; }\n.options-container { display: flex; flex-direction: column; gap: 8px; margin-top: 8px; animation: slideIn 0.3s ease-out; }\n.option-button { padding: 12px; background: white; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: left; font-size: 14px; transition: all 0.2s; font-family: inherit; }\n.option-button:hover { background: ${this.adjustColor(this.config.primaryColor, 90)}; border-color: ${this.config.primaryColor}; transform: translateX(4px); }\n.option-button.primary { background: ${this.config.primaryColor}; color: white; border-color: ${this.config.primaryColor}; font-weight: 600; }\n.option-button.primary:hover { background: ${this.adjustColor(this.config.primaryColor, -10)}; }\n.chatbot-input-area { border-top: 1px solid #e5e7eb; padding: 16px; background: white; }\n.input-actions { display: flex; gap: 8px; margin-bottom: 8px; }\n.input-actions .action-btn { padding: 10px; background: #f3f4f6; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; color: #6b7280; }\n.input-actions .action-btn:hover { background: #e5e7eb; color: #374151; }\n.input-actions .action-btn svg { width: 20px; height: 20px; }\n.input-row { display: flex; gap: 8px; }\n.chatbot-input { flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none; font-family: inherit; }\n.chatbot-input:focus { border-color: ${this.config.primaryColor}; box-shadow: 0 0 0 3px ${this.adjustColor(this.config.primaryColor, 90)}; }\n.send-button { padding: 10px 16px; background: ${this.config.primaryColor}; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-family: inherit; transition: all 0.2s; }\n.send-button:hover { background: ${this.adjustColor(this.config.primaryColor, -10)}; }\n.send-button:disabled { background: #d1d5db; cursor: not-allowed; }\n.loader { border: 2px solid #f3f4f6; border-top: 2px solid ${this.config.primaryColor}; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }\n@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n.submit-button { width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 8px; font-family: inherit; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; }\n.submit-button:hover { background: #059669; }\n.submit-button:disabled { background: #d1d5db; cursor: not-allowed; }\n.ticket-summary { background: white; padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb; margin-top: 8px; }\n.ticket-summary h4 { font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #1f2937; }\n.ticket-summary p { font-size: 12px; margin: 4px 0; color: #4b5563; }\n.ticket-summary strong { color: #1f2937; }\n.image-preview { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; max-height: 150px; overflow-y: auto; padding: 8px; background: #f9fafb; border-radius: 6px; }\n.image-preview-item { position: relative; width: 70px; height: 70px; border-radius: 6px; overflow: hidden; border: 2px solid #e5e7eb; background: white; flex-shrink: 0; }\n.image-preview-item img { width: 100%; height: 100%; object-fit: cover; }\n.image-preview-remove { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; }\n.image-preview-remove:hover { background: #dc2626; transform: scale(1.1); }\n@media (max-width: 480px) {\n  .chatbot-window { width: 100vw; height: 100vh; border-radius: 0; }\n  .support-chatbot { bottom: 0 !important; right: 0 !important; left: 0 !important; top: 0 !important; }\n}`, e = document.createElement("style"); e.textContent = t, document.head.appendChild(e) } getPositionStyles() { const t = { "bottom-right": "bottom: 20px; right: 20px;", "bottom-left": "bottom: 20px; left: 20px;", "top-right": "top: 20px; right: 20px;", "top-left": "top: 20px; left: 20px;" }; return t[this.config.position] || t["bottom-right"] } adjustColor(t, e) { const i = t => Math.min(Math.max(t, 0), 255), o = parseInt(t.replace("#", ""), 16); return "#" + (16777216 + (i((o >> 16) + e) << 16) + (i((o >> 8 & 255) + e) << 8) + i((255 & o) + e)).toString(16).slice(1) } createChatbotUI() { this.container = document.createElement("div"), this.container.className = "support-chatbot", this.container.innerHTML = this.renderChatbot(), document.body.appendChild(this.container), this.attachEventListeners() } renderChatbot() { return `${this.state.isOpen ? this.renderWindow() : this.renderButton()}` } renderButton() { return `\n<button class="chatbot-button" onclick="window.supportChatbot.toggle()">\n  <svg viewBox="0 0 24 24">\n    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>\n  </svg>\n  <div class="chatbot-error-badge">${this.state.detectedErrors.length}</div>\n</button>` } renderWindow() { return `\n<div class="chatbot-window open">\n  <div class="chatbot-header">\n    <div class="chatbot-header-title">\n      <svg width="20" height="20" viewBox="0 0 24 24" fill="white">\n        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>\n      </svg>\n      <span>${this.config.chatbotName}</span>\n    </div>\n    <button class="chatbot-close" onclick="window.supportChatbot.toggle()">√ó</button>\n  </div>\n  <div class="chatbot-messages" id="chatbot-messages">\n    ${this.renderMessages()}\n    ${this.renderOptions()}\n    ${this.state.isLoading ? '<div class="message bot"><div class="message-content"><div class="loader"></div></div></div>' : ""}\n  </div>\n  <div class="chatbot-input-area">\n    ${this.renderImagePreviews()}\n    <div class="input-actions">\n      <input type="file" id="chatbot-file-input" accept="${this.config.allowedFileTypes.join(",")}" multiple style="display: none;">\n      <button onclick="document.getElementById('chatbot-file-input').click()" title="Upload image" class="action-btn">\n        <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>\n      </button>\n      ${this.config.enableScreenshot ? '<button onclick="window.supportChatbot.captureScreenshot()" title="Take screenshot" class="action-btn">\n        <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>\n      </button>' : ""}\n    </div>\n    <div class="input-row">\n      <input type="text" id="chatbot-input" class="chatbot-input" placeholder="Type a message..." />\n      <button class="send-button" onclick="window.supportChatbot.send()">Send</button>\n    </div>\n  </div>\n</div>` } renderMessages() { return this.state.messages.map((t => `\n<div class="message ${t.sender}">\n  <div class="message-content">\n    ${this.escapeHtml(t.text)}\n    <div class="message-time">${this.formatTime(t.timestamp)}</div>\n  </div>\n</div>`)).join("") } renderOptions() { const t = this.state.currentStep, e = this.state.ticketData; return "error_detected" === t ? '<div class="options-container">\n<button class="option-button primary" onclick="window.supportChatbot.reportDetectedError()">\n  üêõ Report This Error\n</button>\n<button class="option-button" onclick="window.supportChatbot.dismissError()">\n  ‚ùå Dismiss\n</button>\n</div>' : "closed" === t ? "" : "greeting" === t ? '<div class="options-container">\n<button class="option-button primary" onclick="window.supportChatbot.startReportIssue()">üõ† Open a support ticket</button>\n</div>' : "new_ticket_prompt" === t ? '<div class="options-container">\n<button class="option-button primary" onclick="window.supportChatbot.handleNewTicketResponse(\'yes\')">‚úÖ Yes, create another ticket</button>\n<button class="option-button" onclick="window.supportChatbot.handleNewTicketResponse(\'no\')">‚ùå No, I\'m done</button>\n</div>' : "contact_prompt" === t ? '<div class="options-container">\n<button class="option-button primary" onclick="window.supportChatbot.selectContactOption(\'provide\')">‚úÖ Yes, I\'ll provide my email</button>\n<button class="option-button" onclick="window.supportChatbot.selectContactOption(\'skip\')">‚è≠Ô∏è Skip (submit anonymously)</button>\n</div>' : "impact" === t ? `<div class="options-container">\n${this.options.impact.map((t => `<button class="option-button" onclick="window.supportChatbot.selectOption('impact', '${t.id}')">${t.label}</button>`)).join("")}\n</div>` : "urgency" === t ? `<div class="options-container">\n${this.options.urgency.map((t => `<button class="option-button" onclick="window.supportChatbot.selectOption('urgency', '${t.id}')">${t.label}</button>`)).join("")}\n</div>` : "priority" === t ? `<div class="options-container">\n${this.options.priority.map((t => `<button class="option-button" onclick="window.supportChatbot.selectOption('priority', '${t.id}')">${t.label}</button>`)).join("")}\n</div>` : "category" === t ? `<div class="options-container">\n${this.options.category.map((t => `<button class="option-button" onclick="window.supportChatbot.selectOption('category', '${t}')">${t}</button>`)).join("")}\n</div>` : "confirmation" === t ? `\n<div class="ticket-summary">\n  <h4>üìã Ticket Summary</h4>\n  <p><strong>Description:</strong> ${e.description}</p>\n  <p><strong>Impact:</strong> ${e.impact}</p>\n  <p><strong>Urgency:</strong> ${e.urgency}</p>\n  <p><strong>Priority:</strong> ${e.priority}</p>\n  <p><strong>Category:</strong> ${e.category}</p>\n  ${e.contactDetails ? `<p><strong>Contact:</strong> ${e.contactDetails}</p>` : "<p><strong>Contact:</strong> Anonymous</p>"}\n  ${e.images.length > 0 ? `<p><strong>Attachments:</strong> ${e.images.length} file(s)</p>` : ""}\n  ${this.state.detectedErrors.length > 0 ? `<p><strong>Detected Errors:</strong> ${this.state.detectedErrors.length} error(s)</p>` : ""}\n</div>\n<button class="submit-button" onclick="window.supportChatbot.submitTicket()">\n  <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M20 6L9 17l-5-5"/></svg>\n  Submit Ticket\n</button>` : "" } renderImagePreviews() { return 0 === this.state.uploadedImages.length ? "" : `\n<div class="image-preview">\n  ${this.state.uploadedImages.map(((t, e) => `\n    <div class="image-preview-item">\n      <img src="${t.data}" alt="${t.name}" />\n      <button class="image-preview-remove" onclick="window.supportChatbot.removeImage(${e})">√ó</button>\n    </div>`)).join("")}\n</div>` } attachEventListeners() { const t = this.container?.querySelector("#chatbot-input"), e = this.container?.querySelector("#chatbot-file-input"); t && t.addEventListener("keypress", (t => { "Enter" === t.key && this.send() })), e && e.addEventListener("change", (t => this.handleFileUpload(t))) } addMessage(t, e) { this.state.messages.push({ sender: t, text: e, timestamp: new Date }), this.render(), this.scrollToBottom() } startReportIssue() { this.addMessage("user", "üõ† Open a support ticket"), this.state.currentStep = "description", this.addMessage("bot", "Please describe the issue you're experiencing in detail:") } handleNewTicketResponse(t) { "yes" === t ? (this.addMessage("user", "‚úÖ Yes, create another ticket"), this.state.ticketData = this.initTicketData(), this.state.uploadedImages = [], this.state.currentStep = "description", this.addMessage("bot", "Please describe the issue you're experiencing in detail:")) : (this.addMessage("bot", "Thank you for using our support system! Feel free to reach out anytime. üëã"), this.state.currentStep = "closed", setTimeout((() => { this.state.currentStep = "greeting", this.render() }), 1e3)) } async reportDetectedError() { if (!this.state.pendingError) return; this.addMessage("user", "üêõ Report This Error"), this.addMessage("bot", "üìù Submitting error report..."); const e = this.state.pendingError, i = `${e.type}-${e.message}`; this.state.autoReportedErrors.push(i); const o = this.buildErrorDescription(e), s = { ...this.config.autoReportDefaults, description: o, images: [], errors: [e], metadata: { userAgent: navigator.userAgent, url: t.location.href, timestamp: (new Date).toISOString(), sessionId: this.state.sessionId, userReported: !0 } }; try { const t = new FormData; for (const e in s) "images" !== e && "errors" !== e && t.append(e, "object" == typeof s[e] ? JSON.stringify(s[e]) : s[e]); const e = `${this.config.apiBaseUrl}${this.config.endpoints.createTicket}`, i = await fetch(e, { method: "POST", body: t }), o = await i.json(); this.addMessage("bot", `‚úÖ Error reported successfully as ticket #${o.ticketId}. Our team will investigate this issue.`), this.config.onTicketCreated && this.config.onTicketCreated(ticketId, s), this.state.pendingError = null, this.state.detectedErrors = [], this.updateErrorBadge(), setTimeout((() => { this.state.currentStep = "greeting", this.render() }), 3e3) } catch (e) { this.addMessage("bot", "‚ùå Failed to submit error report. Please try again."), this.state.currentStep = "error_detected" } } dismissError() { this.addMessage("user", "‚ùå Dismiss"), this.addMessage("bot", "Okay, I've dismissed this error. Let me know if you need anything else!"), this.state.pendingError = null, this.state.currentStep = "greeting", this.render() } selectContactOption(t) { "provide" === t ? (this.addMessage("user", "‚úÖ Yes, I'll provide my email"), this.state.currentStep = "contact", this.addMessage("bot", "Please provide your email address:")) : (this.addMessage("user", "‚è≠Ô∏è Skip (submit anonymously)"), this.state.ticketData.contactDetails = "Anonymous", this.state.currentStep = "confirmation", this.addMessage("bot", "Perfect! Review your ticket and click Submit when ready.")) } send() { const t = this.container?.querySelector("#chatbot-input"), e = t?.value.trim(); e && (this.addMessage("user", e), t.value = "", "description" === this.state.currentStep ? (this.state.ticketData.description = e, this.state.currentStep = "impact", this.addMessage("bot", "Thanks! Now, who is affected by this issue?"), this.render()) : "contact" === this.state.currentStep && (this.state.ticketData.contactDetails = e, this.state.currentStep = "confirmation", this.addMessage("bot", "Perfect! Review your ticket and click Submit when ready."))) } selectOption(t, e) { this.state.ticketData[t] = e, this.addMessage("user", e); const i = { category: { next: "contact_prompt", msg: "Would you like to provide your email address for follow-up?" }, impact: { next: "urgency", msg: "How urgent is this issue for you?" }, urgency: { next: "priority", msg: "What priority level would you assign?" }, priority: { next: "category", msg: "Please select the category:" } }; i[t] && (this.state.currentStep = i[t].next, this.addMessage("bot", i[t].msg)) } handleFileUpload(t) { const e = Array.from(t.target.files); if (!e || 0 === e.length) return; if (this.state.uploadedImages.length + e.length > this.config.maxFiles) return this.addMessage("bot", `‚ùå Too many files. Maximum ${this.config.maxFiles} files allowed.`), void (t.target.value = ""); e.forEach((t => { if (!this.config.allowedFileTypes.includes(t.type)) return void this.addMessage("bot", `‚ùå File type not allowed: ${t.name}`); if (t.size > this.config.maxFileSize) { const e = (this.config.maxFileSize / 1024 / 1024).toFixed(1); return void this.addMessage("bot", `‚ùå File too large: ${t.name} (max ${e}MB)`) } this.state.ticketData.images.push(t); const e = new FileReader; e.onload = e => { this.state.uploadedImages.push({ name: t.name, type: t.type, size: t.size, data: e.target.result, uploadedAt: (new Date).toISOString() }), this.updateImagePreview() }, e.readAsDataURL(t) })), t.target.value = "" } async captureScreenshot() { "undefined" == typeof html2canvas && await this.loadScript("https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"); try { await new Promise((t => setTimeout(t, 500))); (await html2canvas(document.body, { allowTaint: !0, useCORS: !0, backgroundColor: "#ffffff", scale: 2, logging: !1 })).toBlob((t => { const e = new FileReader; e.onload = e => { if (this.state.uploadedImages.length >= this.config.maxFiles) return void this.addMessage("bot", `‚ùå Maximum ${this.config.maxFiles} files reached.`); const i = e.fileName; this.state.uploadedImages.push({ name: i, type: "image/png", size: t.size, data: e.target.result, isScreenshot: !0, uploadedAt: (new Date).toISOString() }), this.state.ticketData.images.push({ name: i, type: "image/png", size: t.size, data: e.target.result, isScreenshot: !0 }), this.render() }, e.readAsDataURL(t) }), "image/png") } catch (t) { this.addMessage("bot", `‚ùå Failed to capture screenshot: ${t.message}`) } } loadScript(t) { return new Promise(((e, i) => { const o = document.createElement("script"); o.src = t, o.onload = e, o.onerror = i, document.head.appendChild(o) })) } updateImagePreview() { const t = this.container?.querySelector(".chatbot-input-area"); if (!t) return; const e = t.querySelector(".image-preview"); if (e && e.remove(), this.state.uploadedImages.length > 0) { const e = this.renderImagePreviews(); t.querySelector(".input-actions").insertAdjacentHTML("beforebegin", e) } } removeImage(t) { this.state.uploadedImages.splice(t, 1), this.state.ticketData.images.splice(t, 1), this.updateImagePreview() } async submitTicket() { if (!this.state.ticketData.description || "" === this.state.ticketData.description.trim()) return void this.addMessage("bot", "‚ùå Cannot submit ticket without a description."); this.addMessage("bot", "üìù Creating your ticket..."); const t = this.container?.querySelector(".submit-button"); t && (t.disabled = !0, t.innerHTML = '<div class="loader"></div> Submitting...'); try { const t = new FormData; for (const e in this.state.ticketData) { const i = this.state.ticketData[e]; null != i && ("images" !== e && ("string" == typeof i || "number" == typeof i ? t.append(e, i.toString()) : "object" == typeof i && t.append(e, JSON.stringify(i)))) } this.state.ticketData.images?.forEach((e => { t.append("files", e, e.name) })); const e = `${this.config.apiBaseUrl}${this.config.endpoints.createTicket}`, i = await fetch(e, { method: "POST", body: t }), o = await i.json(); this.addMessage("bot", `‚úÖ Success! Your ticket #${o.ticketId} has been created.`), this.config.onTicketCreated && this.config.onTicketCreated(ticketId, this.state.ticketData), setTimeout((() => { this.state.ticketData = this.initTicketData(), this.state.uploadedImages = [], this.state.detectedErrors = [], this.state.currentStep = "new_ticket_prompt", this.addMessage("bot", "Would you like to create another support ticket?"), this.updateErrorBadge(), this.render() }), 3e3) } catch (e) { this.addMessage("bot", "‚ùå Sorry, there was an error creating your ticket."), this.config.onError && this.config.onError(e), t && (t.disabled = !1, t.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M20 6L9 17l-5-5"/></svg> Submit Ticket') } } toggle() { this.state.isOpen = !this.state.isOpen, this.state.isOpen ? (0 === this.state.messages.length && this.addMessage("bot", `üëã Hello! I'm ${this.config.chatbotName}. How can I help you today?`), this.config.onOpen && this.config.onOpen()) : this.config.onClose && this.config.onClose(), this.render() } open() { this.state.isOpen || this.toggle() } close() { this.state.isOpen && this.toggle() } render() { this.container && (this.container.innerHTML = this.renderChatbot(), this.attachEventListeners(), this.updateErrorBadge()) } scrollToBottom() { setTimeout((() => { const t = this.container?.querySelector("#chatbot-messages"); t && (t.scrollTop = t.scrollHeight) }), 100) } escapeHtml(t) { const e = document.createElement("div"); return e.textContent = t, e.innerHTML } formatTime(t) { return t.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }) } destroy() { this.container && this.container.remove() } } t.SupportChatbot = i, t.chatbotConfig && (t.supportChatbot = new i(t.chatbotConfig)) }(window);